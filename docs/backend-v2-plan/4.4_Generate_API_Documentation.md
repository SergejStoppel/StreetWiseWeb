### **Phase 4: Finalization & Auditing**

#### **Issue #4.4: Generate Comprehensive API Documentation**

- **Problem:** The frontend team and any future API consumers need a clear, accurate, and easy-to-use reference for all available API endpoints.
- **Goal/Benefit:** To improve developer efficiency, reduce integration errors, and make the API easily discoverable and usable while properly documenting multi-tenant considerations.
- **Acceptance Requirements:**
    - [ ] A tool like Swagger UI or Redoc is integrated into the backend project.
    - [ ] OpenAPI (v3) specification annotations are added to all API routes, controllers, and DTOs.
    - [ ] The documentation clearly defines the path, method, parameters, request body, and possible responses for every endpoint.
    - [ ] Workspace-scoped endpoints are clearly marked with required workspace context.
    - [ ] Authentication requirements are documented for each endpoint (public, authenticated, workspace member, workspace admin).
    - [ ] Rate limiting information is included per endpoint.
    - [ ] Example requests and responses include proper workspace IDs and multi-tenant context.
    - [ ] A new endpoint, `/api/docs`, is created that serves the interactive API documentation UI.
    - [ ] The documentation is automatically generated and kept in sync with the code.
    - [ ] **Tests:** Integration tests verify that the OpenAPI spec is valid and all documented endpoints exist.
- **Implementation Details:**
    - Use `swagger-jsdoc` and `swagger-ui-express` for Node.js/Express:
        ```typescript
        import swaggerJsdoc from 'swagger-jsdoc';
        import swaggerUi from 'swagger-ui-express';
        
        const swaggerOptions = {
          definition: {
            openapi: '3.0.0',
            info: {
              title: 'SiteCraft API',
              version: '2.0.0',
              description: 'Multi-tenant web accessibility analysis platform API',
            },
            servers: [
              { url: '/api', description: 'API Base URL' }
            ],
            components: {
              securitySchemes: {
                bearerAuth: {
                  type: 'http',
                  scheme: 'bearer',
                  bearerFormat: 'JWT',
                  description: 'Supabase JWT token'
                }
              },
              schemas: {
                Workspace: {
                  type: 'object',
                  properties: {
                    id: { type: 'string', format: 'uuid' },
                    name: { type: 'string' },
                    owner_id: { type: 'string', format: 'uuid' },
                    created_at: { type: 'string', format: 'date-time' }
                  }
                },
                Analysis: {
                  type: 'object',
                  properties: {
                    id: { type: 'string', format: 'uuid' },
                    website_id: { type: 'string', format: 'uuid' },
                    status: { 
                      type: 'string', 
                      enum: ['pending', 'processing', 'completed', 'failed'] 
                    },
                    overall_score: { type: 'number' },
                    created_at: { type: 'string', format: 'date-time' }
                  }
                }
              }
            }
          },
          apis: ['./src/api/routes/*.ts', './src/api/controllers/*.ts'],
        };
        
        const swaggerSpec = swaggerJsdoc(swaggerOptions);
        app.use('/api/docs', swaggerUi.serve, swaggerUi.setup(swaggerSpec));
        ```
    - Example endpoint documentation:
        ```typescript
        /**
         * @swagger
         * /workspaces/{workspaceId}/analyses:
         *   post:
         *     summary: Start a new website analysis
         *     tags: [Analyses]
         *     security:
         *       - bearerAuth: []
         *     parameters:
         *       - in: path
         *         name: workspaceId
         *         required: true
         *         schema:
         *           type: string
         *           format: uuid
         *         description: The workspace ID
         *     requestBody:
         *       required: true
         *       content:
         *         application/json:
         *           schema:
         *             type: object
         *             required:
         *               - websiteId
         *             properties:
         *               websiteId:
         *                 type: string
         *                 format: uuid
         *                 description: ID of the website to analyze
         *           example:
         *             websiteId: "123e4567-e89b-12d3-a456-426614174000"
         *     responses:
         *       201:
         *         description: Analysis started successfully
         *         content:
         *           application/json:
         *             schema:
         *               $ref: '#/components/schemas/Analysis'
         *       402:
         *         description: Payment required - quota exceeded
         *       403:
         *         description: Access denied to workspace
         *       429:
         *         description: Rate limit exceeded (10 requests per minute)
         */
        ```
    - Define reusable schemas for common objects (Workspace, Analysis, Error).
    - Document webhook payloads and event types.
    - Include code samples in multiple languages (curl, JavaScript, Python).
    - Add versioning strategy documentation.
    - Export OpenAPI spec for SDK generation.