### **Phase 1: Database Schema & Authentication**

#### **Issue #1.2: Implement User Authentication Flow**

- **Problem:** The application needs a secure way for users to sign up, log in, and manage their sessions.
- **Goal/Benefit:** A complete, secure, and user-friendly authentication system that protects user data and application resources.
- **Acceptance Requirements:**
    - [ ] An `auth.routes.ts` file is created with endpoints for `/signup`, `/login`, `/logout`, and `/me`.
    - [ ] The `/signup` controller gracefully handles existing users (returns `409 Conflict`).
    - [ ] The `/signup` controller automatically creates a default workspace for new users.
    - [ ] The `/login` controller returns a JWT on success and `401 Unauthorized` on failure.
    - [ ] A `requireAuth` middleware is created that protects other routes by validating the JWT.
    - [ ] A `requireWorkspace` middleware is created that validates workspace access for multi-tenant isolation.
    - [ ] The `/me` endpoint uses this middleware and returns the profile of the logged-in user including their workspaces.
    - [ ] **Tests:** Integration tests are written for all auth endpoints, covering success and failure scenarios, including workspace creation and access control.
- **Implementation Details:**
    - Use the `@supabase/supabase-js` library to interact with Supabase Auth.
    - The `requireAuth` middleware will get the token from the `Authorization: Bearer <token>` header and use `supabase.auth.getUser(token)` to validate it.
    - The `requireWorkspace` middleware will:
        ```typescript
        // Example implementation
        async function requireWorkspace(req, res, next) {
          const workspaceId = req.params.workspaceId || req.body.workspaceId;
          const userId = req.user.id;
          
          const { data: member } = await supabase
            .from('workspace_members')
            .select('role')
            .eq('workspace_id', workspaceId)
            .eq('user_id', userId)
            .single();
            
          if (!member) {
            return res.status(403).json({ error: 'Access denied to workspace' });
          }
          
          req.workspace = { id: workspaceId, role: member.role };
          next();
        }
        ```
    - Store the Supabase URL and anon key in environment variables, accessed via the `config` module.
    - Ensure all subsequent API calls include workspace context for proper multi-tenant isolation.